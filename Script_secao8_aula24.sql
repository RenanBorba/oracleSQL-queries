-- AULA 23

-- DML - DATA MANIPULATION LANGUAGE (INSERT, UPDATE E DELETE)
--  DIFERENTE DE DDL - DATA DEFINITION LANGUAGE (CREATE, ALTER E DROP)

-- COMMIT E ROLLBACK APENAS PARA DML

CREATE TABLE TDESCONTO
(
  CLASSE VARCHAR(2),
  INFERIOR INTEGER,
  SUPERIOR INTEGER
);

SELECT * FROM TDESCONTO

-- A 00 10
-- B 11 20
-- C 21 30

-- CONFIGURAR: SCRIPT > ENABLE SUBSTITUTION VARIABLES

-- VARIÁVEIS DE SUBSTITUIÇÃO
INSERT INTO TDESCONTO (CLASSE, INFERIOR, SUPERIOR)
-- NOME VARIÁVEL COMEÇANDO COM &
-- '' PARA VARCHAR
-- AO EXECUTAR O INSERT, É SOLICITADO PARA INSERIR OS VALORES
VALUES ('&cla', &inf, &sup);

INSERT INTO TDESCONTO (CLASSE, INFERIOR, SUPERIOR)
VALUES ('&cla', &inf, &sup);

SELECT * FROM TDESCONTO
WHERE CLASSE = '&cla';

UPDATE TDESCONTO SET
  INFERIOR = &inf,
  SUPERIOR = &sup
WHERE CLASSE = '&cla';

DELETE FROM TDESCONTO
WHERE CLASSE = '&cla';


-- COPIAR ESTRUTURA E REGISTROS DE TABELA AO CRIAR UMA TABELA NOVA
CREATE TABLE TDESCONTO2
  AS SELECT * FROM TDESCONTO;

SELECT * FROM TDESCONTO2

-- TRANSAÇÃO (COMMIT/ROLLBACK)

COMMIT;

-- DELETAR TODOS OS REGISTROS
DELETE FROM TDESCONTO2;

-- DESFAZER ALTERAÇÕES
ROLLBACK;

-- DELETAR TODOS OS REGISTROS DA TABELA
--  NÃO TEM CLÁUSULA WHERE
--  SEM A POSSIBILIDADE DE ROLLBACK
TRUNCATE TABLE TDESCONTO2;

COMMIT;


SELECT * FROM TDESCONTO

-- SAVEPOINT - PONTO DE RESTAURAÇÃO
SAVEPOINT upd_b;

UPDATE TDESCONTO SET
  SUPERIOR = 15
WHERE CLASSE = 'B';

SAVEPOINT upd_a;

UPDATE TDESCONTO SET
  SUPERIOR = 10
WHERE CLASSE = 'A';


SELECT * FROM TDESCONTO

-- PONTO DE RESTAURAÇÃO
SAVEPOINT ins_ok;
INSERT INTO TDESCONTO (CLASSE, INFERIOR, SUPERIOR)
VALUES ('&cla', &inf, &sup);

-- DESFAZER ALTERAÇÕES A PARTIR DO SAVEPONT
ROLLBACK TO SAVEPOINT ins_ok;
ROLLBACK TO SAVEPOINT upd_a;


-- EXCLUIR TABELA
DROP TABLE TDESCONTO2;


COMMIT;


































